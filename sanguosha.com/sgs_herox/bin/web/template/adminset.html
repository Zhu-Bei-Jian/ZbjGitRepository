<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <link href="depend/lib/ligerUI/skins/Aqua/css/ligerui-all.css" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" type="text/css" href="/css/style.css" />
    <script src="depend/lib/jquery/jquery-1.9.0.min.js" type="text/javascript"></script>
    <script src="depend/lib/json2.js" type="text/javascript"></script>
    <script src="depend/lib/ligerUI/js/ligerui.min.js" type="text/javascript"></script>
<!--    <script src="depend/EmployeeData.js" type="text/javascript"></script>
    <script src="depend/DepartmentData.js" type="text/javascript"></script>-->
    <script type="text/javascript">
        $(f_initGrid);
        var manager, g;
        function f_initGrid()
        {
           g =  manager = $("#maingrid").ligerGrid({
                columns: [
					{ display: '账号', name: 'Name', width: 250, type: 'text', frozen:true
					},
					// { display: '类型', name: 'UserType', width: 50, type: 'text', frozen:true
					// },
					{ display: '密码', name: 'Password', width: 250, type: 'text',
						editor: { type: 'text' }
					},
					{ display: '权限', name: 'Rights',
						editor: { type: 'text' }
					},
                ],
                onSelectRow: function (rowdata, rowindex)
                {
					//var row = manager.getSelectedRow();
					//$("#saction").show();
                    //$("#sIdServer").text(row.ServerId);
                },
                enabledEdit: true, clickToEdit: false, isScroll: false,
                data:{
					    Rows: [
						{{range .Users}}
					        {
					            "__status": null,
					            "Name": {{.Name}},
					            {{/*"UserType": {{.UserType}},*/}}
					            "Password": "******",
					            "Rights": {{.Rights}},
					        }, 
						{{end}} 
					    ],
					    Total: {{len .Users}},
					},
                width: '100%'
            });
			//$("#saction").hide();
            //$("#sIdServer").text("");
        }
        function beginEdit() {
            var row = manager.getSelectedRow();
            if (!row) { alert('请选择行'); return; }
            manager.beginEdit(row);
        }
        function cancelEdit() {
            var row = manager.getSelectedRow();
            if (!row) { alert('请选择行'); return; }
            manager.cancelEdit(row);
			//location.href = "/";
        }
        function cancelAllEdit()
        {
            manager.cancelEdit();
        }
        function endEdit()
        {
            var row = manager.getSelectedRow();
            if (!row) { alert('请选择行'); return; }
            manager.endEdit(row);
			if (row.__status == "add"){
			}
			if (row.__status == "update"){
				$.post("/UpdateGM",
					{
						Name : row.Name,
						//UserType : row.UserType,
						Pwd : row.Password,
						Rights : row.Rights,
	            	},
					function(ret){
				        // if(ret.Ret == "0") {
				        //     alert(ret.Reason);
						// 	$("#result").text = ret.Reason;
				        // } else {
				        // 	alert(JSON.stringify(ret));
				        // }
						alert(ret.Reason);
						location.href = "/admin_set";
				    },"json")
			}
        }
        function endAllEdit()
        {
            manager.endEdit();
        }
		function AddGM(obj){
			$.post("/AddGM",
				{
					Name : $("#aName").val(),
					Pwd : $("#aPassword").val(),
					Rights: $("#aRightsGroup").val(),					
            	},
				function(ret){
					alert(ret.Reason);
					location.href = "/admin_set";
			    },"json")
		}
        function deleteRow()
        {
            var row = manager.getSelectedRow();
            if (!row) { alert('请选择行'); return; }
			$.post("/RemoveGM",
				{
					Name : row.Name,
            	},
				function(ret){
					alert(ret.Reason);
		        	//alert(JSON.stringify(ret));
		            location.href = "/admin_set";
			    },"json")
        }
    </script>
</head>
<body  style="padding:10px">
	<div class="main">
		<div class="indiv">
			<a class="button white" onclick="beginEdit()">修改行</a>
			<a class="button white" onclick="endEdit()">提交修改行</a>
 			<a class="button white" onclick="cancelEdit()">取消修改</a>
			<a class="button white" onclick="deleteRow()">停用账号</a>
		</div>
	</div>

	<div class="l-clear"></div>

    <div id="maingrid" style="margin-top:20px"></div>
	<br />
	<br />

	{{if eq .IsAdmin 1}}

	<div>
	<table id="createinfo">
	    <tr><td>账号</td><td><input rtype="text" id="aName"></input></td></tr>
	    <tr><td>密码</td><td><input rtype="text" id="aPassword"></input></td></tr>
		<tr><td><input type="button" value="添加账号" onclick="AddGM()" style="width:100px;height:25px"></input></td></tr>
	</table>
	</div>
	<div>

		<table id="rights">
			<tr><td></td><td></td></tr>
			<tr><td></td><td></td></tr>
			<tr><td></td><td></td></tr>
			<tr><td>权限组</td><td>以万为单位设权限组 如1表示10000-19999这组权限</td></tr>
			<tr><td>排除权限</td><td>用负值表示排除该权限</td></tr>
			<tr><td>配置示例</td><td>1;2;30001;-10001</td></tr>
			<tr><td></td><td></td></tr>
			<tr><td></td><td></td></tr>
			<tr><td></td><td></td></tr>
			<tr><td>所有权限</td><td></td></tr>
			{{range .AllRights}}
				<tr><td>{{.Id}}</td><td>{{.Name}}</td></tr>
			{{end}}
		</table>
	</div>
	{{end}}
</body>
</html>
